<!DOCTYPE html>
<html>

<head>
    <title>D&D Agent</title>
    <link rel="stylesheet" href="static/css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&display=swap" rel="stylesheet">
</head>

<body>

    <div id="dice-overlay" class="hidden">
        <img src="static/images/DnD_dice_roll.gif">
    </div>

    <header>
        <h1 class="unifrakturmaguntia-regular">D&D Character Analyzer</h1>
        <h4>UGA Hackathon 2026 Submission</h4>
    </header>

    <div class="user-input">
        <textarea id="description" rows="5" cols="50" placeholder="The magic starts here..."></textarea>
        <button id="submit">Cast your Spell!</button>
    </div>


    <br>
    <pre id="result"></pre>
    <script>

        const messages = ["Infusing a little magic into your character",
            "Be honest, you came here after watching Strangers Thing",
            "Consulting the Elder Scrolls",
            "Bribing the Dungeon Master"];

        const classDescriptions = {
            artificer: {
                name: "Artificer",
                displayText: "A master of magical invention. Artificers use tools and ingenuity to imbue mundane objects with arcane power, crafting magical devices, constructs, and enhancements through a blend of technology and magic.",
            },
            barbarian: {
                name: "Barbarian",
                displayText: "A fierce warrior of primitive background who can enter a battle rage. Barbarians draw on raw physical power, resilience, and primal instincts, shrugging off blows and striking with devastating force. Their rage fuels strength and toughness beyond normal limits.",
            },
            bard: {
                name: "Bard",
                displayText: "An inspiring magician whose power echoes the music of creation. Bards weave magic through words, music, and performance, bolstering allies and confounding foes. They are masters of knowledge, storytelling, and subtle magic.",
            },
            cleric: {
                name: "Cleric",
                displayText: "A priestly champion who wields divine magic in service of a higher power. Clerics channel the will of gods through prayer and faith, healing the wounded, smiting enemies, and shaping reality through divine miracles.",
            },
            druid: {
                name: "Druid",
                displayText: "A priest of the Old Faith, wielding the powers of nature and adopting animal forms. Druids draw strength from the natural world, commanding the elements, communing with beasts, and transforming into animals to protect the balance of nature.",
            },
            fighter: {
                name: "Fighter",
                displayText: "A master of martial combat, skilled with a wide variety of weapons and armor. Fighters rely on physical training, tactical skill, and sheer determination to overcome enemies in battle, adapting to many combat styles.",
            },
            monk: {
                name: "Monk",
                displayText: "A master of martial arts, harnessing inner power known as ki. Monks use disciplined training and spiritual focus to perform extraordinary feats, striking with speed and precision and moving with supernatural agility.",
            },
            paladin: {
                name: "Paladin",
                displayText: "A holy warrior bound by a sacred oath. Paladins combine martial prowess with divine magic, defending the innocent and smiting evil in the name of justice, honor, or devotion to a cause greater than themselves.",
            },
            ranger: {
                name: "Ranger",
                displayText: "A warrior who uses martial prowess and nature magic to combat threats on the edges of civilization. Rangers specialize in tracking, survival, and battling specific enemies, often fighting alongside animal companions or wielding nature-based spells.",
            },
            rogue: {
                name: "Rogue",
                displayText: "A scoundrel who uses stealth and trickery to overcome obstacles and enemies. Rogues rely on agility, cunning, and precise strikes, excelling at infiltration, deception, and exploiting weaknesses.",
            },
            sorcerer: {
                name: "Sorcerer",
                displayText: "A spellcaster who draws on inherent magic from a gift or bloodline. Sorcerers wield powerful magic through instinct and force of will, shaping spells in unique ways rather than relying on formal study.",
            },
            warlock: {
                name: "Warlock",
                displayText: "A wielder of magic derived from a pact with an otherworldly being. Warlocks gain supernatural abilities through bargains with powerful patrons, blending arcane magic with eldritch power.",
            },
            wizard: {
                name: "Wizard",
                displayText: "A scholarly magic-user capable of manipulating the structures of reality. Wizards learn spells through intense study, mastering a vast range of arcane magic and recording their knowledge in spellbooks.",
            }
        };

        function getClassDescription(class_name) {
            const input = class_name;
            let classImg;
            let classDescription;
            //console.log(class_name);
            switch (input) {
                case "Artificer":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/ArtificerDND.png";
                    break;
                case "Barbarian":
                    classDescription = classDescriptions.barbarian.displayText;
                    classImg = "static/images/BarbarianDND.png";
                    break;
                case "Bard":
                    classDescription = classDescriptions.bard.displayText;
                    classImg = "static/images/BardDND.png";
                    break;
                case "Cleric":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/ClericDND.png";
                    break;
                case "Druid":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/DruidDND.png";
                    break;
                case "Fighter":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/FighterDND.png";
                    break;
                case "Monk":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/MonkDND.png";
                    break;
                case "Paladin":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/PaladinDND.png";
                    break;
                case "Ranger":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/RangerDND.png";
                    break;
                case "Rogue":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/RogueDND.png";
                    break;
                case "Sorcerer":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/SorcererDND.png";
                    break;
                case "Warlock":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/WarlockDND.png";
                    break;
                case "Wizard":
                    classDescription = classDescriptions.artificer.displayText;
                    classImg = "static/images/WizardDND.png";
                    break;
                default:
                    classDescription = "Class lost to the wind. You must find your own class.";
                    classImg = "nope";

            }
            return {"classDesc":classDescription, "imgClass":classImg};
        }

        function chooseMessage() {
            const index = Math.floor(Math.random() * messages.length);
            return messages[index];
        }

        document.getElementById("submit").addEventListener("click", async () => {
            const description = document.getElementById("description").value;
            const resultBox = document.getElementById("result");
            const overlay = document.getElementById("dice-overlay");
            const grid = document.querySelector(".grid-container");

            resultBox.textContent = chooseMessage();
            resultBox.classList.add('loading');

            try {
                overlay.classList.remove('hidden');


                const response = await fetch("/analyze", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ description })
                });

                // Force a minimum wait of 2 seconds so the GIF can play
                await new Promise(resolve => setTimeout(resolve, 2000));

                //const data = await response.json();
                //resultBox.textContent = data.character_sheet;

                const data = await response.json();


                if (data.pdf_url) {
                    // Trigger download
                    const a = document.createElement("a");
                    a.href = data.pdf_url;
                    a.download = "character_sheet.pdf";
                    a.click();

                    // Display PDF in viewer
                    const charName = data.charName;
                    //className = data['classes'][0][name];
                    const className = data.class_name;
                    const raceName = data.char_race;
                    const backstoryText = data.backstory;

                    //console.log(className);

                    document.getElementById("pdfViewer").src = data.pdf_url;
                    document.getElementById("class-description").textContent = getClassDescription(className).classDesc;
                    document.getElementById("backstoryText").textContent = backstoryText;
                    document.getElementById("race-name").textContent = raceName;
                    document.getElementById("class-name").textContent = className;
                    document.getElementById("character-name").textContent = charName;
                    const img = document.getElementById("class-img");
                    img.src = getClassDescription(className).imgClass;
                    resultBox.textContent = "Done! PDF downloaded.";
                }
                else {
                    console.log(response)
                    resultBox.textContent = "Error: " + (data.error || "Unknown error");
                    console.log(data);
                }

            } catch (error) {
                console.error("Backend is down!,", error);
                resultBox.textContent = "The tavern is closed (Server Error)";
            } finally {
                overlay.classList.add("hidden");
                grid.classList.remove("hidden");
            }

        });

    </script>

    <section class="grid-container hidden">
        <div class="offical-art card" >
            <img src="static/images/Barbarian%20DND.png" id="class-img">
        <div class="offical-art card">
            <img src="static/images/Barbarian%20DND.png" id="class-img">
        </div>
        <div class="character-info card">
            <h2 class="unifrakturmaguntia-regular" id="character-name">Character name</h2>
            <h3 class="unifrakturmaguntia-regular">class</h3>
            <p id="class-name">class name goes here</p>
            <h3 class="unifrakturmaguntia-regular">race</h3>
            <p id="race-name">race name goes here</p>
        </div>
        <div class="pdf-viewer card">
            <h2 class="unifrakturmaguntia-regular">pdf-view</h2>
            <iframe src="dnd_pdf_filler_simple/assets/5E_CharacterSheet_Fillable.pdf" id="pdfViewer" style="width: 95%; height: 500px;"></iframe>
        </div>
        <div class="class-description card">
            <h2 class="unifrakturmaguntia-regular">Class Description</h2>
            <p id="class-description">class description goes here</p>
        </div>
        <div class="Backstory card">
            <h2 class="unifrakturmaguntia-regular" id="backstory">Backstory</h2>
            <p id="backstoryText">backstory goes here</p>
        </div>
    </section>

</body>

</html>